kind: pipeline
type: docker
name: default

steps:
- name: lint-code
  image: golang:alpine
  environment:
    GOLINTCI_VERSION: v1.50.1
    CGO_ENABLED: 0
    GOOS: linux
  commands:
  - go get
  - wget -O- -nv https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s -- -b $(go env GOPATH)/bin ${GOLINTCI_VERSION}
  - golangci-lint --version
  - golangci-lint run

- name: build-code
  image: golang:alpine
  environment:
    CGO_ENABLED: 0
    GOOS: linux
  commands:
  - go build -a -installsuffix cgo -o wbar
  when:
    ref:
    - refs/tags/*
  depends_on:
  - lint-code
